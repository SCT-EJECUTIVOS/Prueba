;!
;! Automatically generated configuration file
;! Filename: extensions.conf (/etc/asterisk/extensions.conf)
;! Generator: Manager
;! Creation Date: Tue Apr 28 12:36:49 2009
;!
;********************************************
;****  CARACTERISTICAS GENERALES

[general]
static = yes
writeprotect=no
autofallthrough=yes
clearglobalvars = no
priorityjumping = yes

;********************************************
;****  VARIABLES GLOBALES

[globals]
FEATURES = 
DIALOPTIONS = 
RINGTIME = 20
FOLLOWMEOPTIONS = 
PAGING_HEADER = Intercom
DIRGRABACIONES=/data/grabaciones/

;********************************************
;****  CONTEXTOS

[from_etb]
;exten => s,1,Goto(ivr,s,1)
exten => s,1,Answer()
exten => s,n,Wait(3)
exten => s,n,Dial(IAX2/300)

[from_colmena]
exten => s,1,Answer()
exten => s,n,NoOp(Callerid seteado a ${CALLERID(num)})
exten => s,n,Dial(SIP/232,20,t)
exten => s,n,Hangup()
[from_telmex]
exten => 7431616,1,Goto(ivr,s,1)
exten => 601,1,Goto(ivr,s,1)

[from_celular]
exten => s,1,Goto(ivr,s,1)
exten => 601,1,Goto(ivr,s,1)
exten => 214,1,Goto(ivr,s,1)

[celular]
include => users

;********  Llamadas extendida local para que salga por el gatyeway GSM *********
exten => _9NXXXXX,1,Answer()
exten => _9NXXXXX,n,NoOp(extension ${CALLERID(num)})
;exten => _8NXXXXX,n,GotoIf($["${DB(users/t${CALLERID(num)}/Record)}" = "1"]?Record:NoRecord)
exten => _9NXXXXX,n(Record),set(calltime=${STRFTIME(${EPOCH},,%C%y%m%d_%H%M%S)})
;exten => _8NXXXXX,n,MixMonitor(/data/grabaciones/${CALLERID(num)}/saliente/${calltime}_${CALLERID(num)}_${EXTEN}.wav,b)
exten => _9NXXXXX,n,Set(filename=BED4_${idcliente}_${calltime}_${CALLERID(num)}_${EXTEN})
exten => _9NXXXXX,n,Set(CDR(userfield)=${idcliente})
exten => _9NXXXXX,n,NoOp(El nombre del archivo es ${filename})
exten => _9NXXXXX,n,MixMonitor(${DIRGRABACIONES}${CALLERID(num)}/saliente/${filename}.wav)
exten => _9NXXXXX,n(NoRecord),NoOp(No se graba)
exten => _9NXXXXX,n,Dial(SIP/031${EXTEN}@610,60,T)
exten => _9NXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _9NXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _9NXXXXX,n,Dial(SIP/01031${EXTEN}@611,60,tT)
exten => _9NXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _9NXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _9NXXXXX,n,Dial(SIP/02031${EXTEN}@612,60,tT)
exten => _9NXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _9NXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _9NXXXXX,n,Dial(SIP/03031${EXTEN}@613,60,tT)
exten => _9NXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _9NXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _9NXXXXX,n,Dial(SIP/04031${EXTEN}@614,60,tT)
exten => _9NXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _9NXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _9NXXXXX,n(colgar),HangUp()
;*****************************************************************************************************************

;********  Llamadas larga distancia nacional para que salga por el gatyeway GSM *********
exten => _03.,1,Answer()
exten => _03.,n,NoOp(extension ${CALLERID(num)})
;exten => _03.,n,GotoIf($["${DB(users/t${CALLERID(num)}/Record)}" = "1"]?Record:NoRecord)
exten => _03.,n(Record),set(calltime=${STRFTIME(${EPOCH},,%C%y%m%d_%H%M%S)})
;exten => _03.,n,MixMonitor(/data/grabaciones/${CALLERID(num)}/saliente/${calltime}_${CALLERID(num)}_${EXTEN}.wav,b)
exten => _03.,n,Set(filename=BED4_${idcliente}_${calltime}_${CALLERID(num)}_${EXTEN})
exten => _03.,n,Set(CDR(userfield)=${idcliente})
exten => _03.,n,NoOp(El nombre del archivo es ${filename})
exten => _03.,n,MixMonitor(${DIRGRABACIONES}${CALLERID(num)}/saliente/${filename}.wav)
exten => _03.,n(NoRecord),NoOp(No se graba)
exten => _03.,n,Dial(SIP/${EXTEN}@610,60,T)
exten => _03.,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _03.,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _03.,n,Dial(SIP/01${EXTEN}@611,60,tT)
exten => _03.,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _03.,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _03.,n,Dial(SIP/02${EXTEN}@612,60,tT)
exten => _03.,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _03.,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _03.,n,Dial(SIP/03${EXTEN}@613,60,tT)
exten => _03.,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _03.,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _03.,n,Dial(SIP/04${EXTEN}@614,60,tT)
exten => _03.,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _03.,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _03.,n(colgar),HangUp()
;*****************************************************************************************************************

;********  Llamadas  a AVANTEL que salga por el gatyeway GSM *********
exten => _35[0-4]XXXXXXX,1,Answer()
exten => _35[0-4]XXXXXXX,n,NoOp(extension ${CALLERID(num)})
;exten => _3[12][0-4]XXXXXXX,n,GotoIf($["${DB(users/t${CALLERID(num)}/Record)}" = "1"]?Record:NoRecord)
exten => _35[0-4]XXXXXXX,n(Record),set(calltime=${STRFTIME(${EPOCH},,%C%y%m%d_%H%M%S)})
;exten => _3[12][0-4]XXXXXXX,n,MixMonitor(${DIRGRABACIONES}${CALLERID(num)}/saliente/${calltime}_${CALLERID(num)}_${EXTEN}.wav,b)
exten => _35[0-4]XXXXXXX,n,Set(filename=BED4_${idcliente}_${calltime}_${CALLERID(num)}_${EXTEN})
exten => _35[0-4]XXXXXXX,n,Set(CDR(userfield)=${idcliente})
exten => _35[0-4]XXXXXXX,n,NoOp(El nombre del archivo es ${filename})
exten => _35[0-4]XXXXXXX,n,MixMonitor(${DIRGRABACIONES}${CALLERID(num)}/saliente/${filename}.wav)
exten => _35[0-4]XXXXXXX,n(NoRecord),NoOp(No se graba)
exten => _35[0-4]XXXXXXX,n,Dial(SIP/01${EXTEN}@611,60,tT)
exten => _35[0-4]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _35[0-4]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _35[0-4]XXXXXXX,n,Dial(SIP/02${EXTEN}@612,60,tT)
exten => _35[0-4]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _35[0-4]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _35[0-4]XXXXXXX,n,Dial(SIP/03${EXTEN}@613,60,tT)
exten => _35[0-4]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _35[0-4]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _35[0-4]XXXXXXX,n,Dial(SIP/04${EXTEN}@614,60,tT)
exten => _35[0-4]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _35[0-4]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _35[0-4]XXXXXXX,n,Dial(SIP/${EXTEN}@610,60,tT)
exten => _35[0-4]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _35[0-4]XXXXXXX,n,NoOp(El campo userfield esta en: ${CDR(userfield)} y el unique id en: ${CDR(uniqueid)})
exten => _35[0-4]XXXXXXX,n(colgar),Hangup()
;*****************************************************************************************************************

;********  Llamadas  a COMCEL que salga por el gatyeway GSM *********
exten => _3[12][0-4]XXXXXXX,1,Answer()
exten => _3[12][0-4]XXXXXXX,n,NoOp(extension ${CALLERID(num)})
;exten => _3[12][0-4]XXXXXXX,n,GotoIf($["${DB(users/t${CALLERID(num)}/Record)}" = "1"]?Record:NoRecord)
exten => _3[12][0-4]XXXXXXX,n(Record),set(calltime=${STRFTIME(${EPOCH},,%C%y%m%d_%H%M%S)})
;exten => _3[12][0-4]XXXXXXX,n,MixMonitor(${DIRGRABACIONES}${CALLERID(num)}/saliente/${calltime}_${CALLERID(num)}_${EXTEN}.wav,b)
exten => _3[12][0-4]XXXXXXX,n,Set(filename=BED4_${idcliente}_${calltime}_${CALLERID(num)}_${EXTEN})
exten => _3[12][0-4]XXXXXXX,n,Set(CDR(userfield)=${idcliente})
exten => _3[12][0-4]XXXXXXX,n,NoOp(El nombre del archivo es ${filename})
exten => _3[12][0-4]XXXXXXX,n,MixMonitor(${DIRGRABACIONES}${CALLERID(num)}/saliente/${filename}.wav)
exten => _3[12][0-4]XXXXXXX,n(NoRecord),NoOp(No se graba)
exten => _3[12][0-4]XXXXXXX,n,Dial(SIP/01${EXTEN}@611,60,tT)
exten => _3[12][0-4]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _3[12][0-4]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _3[12][0-4]XXXXXXX,n,Dial(SIP/02${EXTEN}@612,60,tT)
exten => _3[12][0-4]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _3[12][0-4]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _3[12][0-4]XXXXXXX,n,Dial(SIP/03${EXTEN}@613,60,tT)
exten => _3[12][0-4]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _3[12][0-4]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _3[12][0-4]XXXXXXX,n,Dial(SIP/04${EXTEN}@614,60,tT)
exten => _3[12][0-4]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _3[12][0-4]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _3[12][0-4]XXXXXXX,n,Dial(SIP/${EXTEN}@610,60,tT)
exten => _3[12][0-4]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _3[12][0-4]XXXXXXX,n,NoOp(El campo userfield esta en: ${CDR(userfield)} y el unique id en: ${CDR(uniqueid)})
exten => _3[12][0-4]XXXXXXX,n(colgar),Hangup()
;*****************************************************************************************************************

;********  Llamadas  a TIGO que salga por las plantas celular puertos 2 y 4 *********
exten => _30[0-6]XXXXXXX,1,Answer()
exten => _30[0-6]XXXXXXX,n,NoOp(extension ${CALLERID(num)})
;exten => _30[0-4]XXXXXXX,n,GotoIf($["${DB(users/t${CALLERID(num)}/Record)}" = "1"]?Record:NoRecord)
exten => _30[0-6]XXXXXXX,n(Record),set(calltime=${STRFTIME(${EPOCH},,%C%y%m%d_%H%M%S)})
;exten => _30[0-4]XXXXXXX,n,MixMonitor(/data/grabaciones/${CALLERID(num)}/saliente/${calltime}_${CALLERID(num)}_${EXTEN}.wav,b)
exten => _30[0-6]XXXXXXX,n,Set(filename=BED4_${idcliente}_${calltime}_${CALLERID(num)}_${EXTEN})
exten => _30[0-6]XXXXXXX,n,Set(CDR(userfield)=${idcliente})
exten => _30[0-6]XXXXXXX,n,NoOp(El nombre del archivo es ${filename})
exten => _30[0-6]XXXXXXX,n,MixMonitor(${DIRGRABACIONES}${CALLERID(num)}/saliente/${filename}.wav)
exten => _30[0-6]XXXXXXX,n(NoRecord),NoOp(No se graba)
exten => _30[0-6]XXXXXXX,n,Dial(SIP/01${EXTEN}@611,60,tT)
exten => _30[0-6]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _30[0-6]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _30[0-6]XXXXXXX,n,Dial(SIP/02${EXTEN}@612,60,tT)
exten => _30[0-6]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _30[0-6]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _30[0-6]XXXXXXX,n,Dial(SIP/03${EXTEN}@613,60,tT)
exten => _30[0-6]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _30[0-6]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _30[0-6]XXXXXXX,n,Dial(SIP/04${EXTEN}@614,60,tT)
exten => _30[0-6]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _30[0-6]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _30[0-6]XXXXXXX,n,Dial(SIP/${EXTEN}@610,60,tT)
exten => _30[0-6]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _30[0-6]XXXXXXX,n,NoOp(El campo userfield esta en : ${CDR(userfield)} y el unique id en : ${CDR(uniqueid)})
exten => _30[0-6]XXXXXXX,n(colgar),Hangup()
;*****************************************************************************************************************

;********  Llamadas  a MOVISTAR que salga por las plantas celular puertos 2 y 4 *********
exten => _31[5-9]XXXXXXX,1,Answer()
exten => _31[5-9]XXXXXXX,n,NoOp(extension ${CALLERID(num)})
;exten => _31[5-9]XXXXXXX,n,GotoIf($["${DB(users/t${CALLERID(num)}/Record)}" = "1"]?Record:NoRecord)
exten => _31[5-9]XXXXXXX,n(Record),set(calltime=${STRFTIME(${EPOCH},,%C%y%m%d_%H%M%S)})
;exten => _31[5-9]XXXXXXX,n,MixMonitor(${DIRGRABACIONES}${CALLERID(num)}/saliente/${calltime}_${CALLERID(num)}_${EXTEN}.wav,b)
exten => _31[5-9]XXXXXXX,n,Set(filename=BED4_${idcliente}_${calltime}_${CALLERID(num)}_${EXTEN})
exten => _31[5-9]XXXXXXX,n,Set(CDR(userfield)=${idcliente})
exten => _31[5-9]XXXXXXX,n,NoOp(El nombre del archivo es ${filename})
exten => _31[5-9]XXXXXXX,n,MixMonitor(${DIRGRABACIONES}${CALLERID(num)}/saliente/${filename}.wav)
exten => _31[5-9]XXXXXXX,n(NoRecord),NoOp(No se graba)
exten => _31[5-9]XXXXXXX,n,Dial(SIP/${EXTEN}@610,60,tT)
exten => _31[5-9]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _31[5-9]XXXXXXX,n,Dial(SIP/01${EXTEN}@611,60,tT)
exten => _31[5-9]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _31[5-9]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _31[5-9]XXXXXXX,n,Dial(SIP/02${EXTEN}@612,60,tT)
exten => _31[5-9]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _31[5-9]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _31[5-9]XXXXXXX,n,Dial(SIP/03${EXTEN}@613,60,tT)
exten => _31[5-9]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _31[5-9]XXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _31[5-9]XXXXXXX,n,Dial(SIP/04${EXTEN}@614,60,tT)
exten => _31[5-9]XXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _31[5-9]XXXXXXX,n,NoOp(El campo userfield est en : ${CDR(userfiield)} y el unique id en ${CDR(uniiqueid)})
exten => _31[5-9]XXXXXXX,n(colgar),Hangup()
;*****************************************************************************************************************
[colmena]
include => users

exten => _3XXXXXXXXX,1,Answer()
exten => _3XXXXXXXXX,n,NoOp(extension ${CALLERID(num)})
;exten => _3XXXXXXXXX,n,GotoIf($["${DB(users/t${CALLERID(num)}/Record)}" = "1"]?Record:NoRecord)
exten => _3XXXXXXXXX,n(Record),set(calltime=${STRFTIME(${EPOCH},,%C%y%m%d_%H%M%S)})
exten => _3XXXXXXXXX,n,MixMonitor(${DIRGRABACIONES}${CALLERID(num)}/saliente/${calltime}_${CALLERID(num)}_${EXTEN}.wav,b)
exten => _3XXXXXXXXX,n(NoRecord),NoOp(No se graba)
exten => _3XXXXXXXXX,n,Dial(SIP/01${EXTEN}@611,60,tT)
exten => _3XXXXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _3XXXXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _3XXXXXXXXX,n,Dial(SIP/02${EXTEN}@612,60,tT)
exten => _3XXXXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _3XXXXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _3XXXXXXXXX,n,Dial(SIP/03${EXTEN}@613,60,tT)
exten => _3XXXXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _3XXXXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _3XXXXXXXXX,n,Dial(SIP/04${EXTEN}@614,60,tT)
exten => _3XXXXXXXXX,n,NoOp(El status de la llamada es: ${DIALSTATUS})
exten => _3XXXXXXXXX,n,GotoIf($[$["${DIALSTATUS}" = "CONGESTION"] | $["${DIALSTATUS}" = "CHANUNAVAIL"]]?:colgar)
exten => _3XXXXXXXXX,n,Dial(SIP/${EXTEN}@610,60,tT)
exten => _3XXXXXXXXX,n(colgar),HangUp()

[cedulacolpAMI]
exten => _X.,1,Set(idcliente=${CEDULA})
exten => _X.,n,Set(numero=${EXTEN})
exten => _X.,n,Set(asesor=${ASESOR})
exten => _X.,n,GotoIf($[${LEN(${numero})}<4]?interno)
exten => _X.,n,NoOp(El numero marcado es ${numero})
exten => _X.,n,NoOp(La cedula del cliente es ${idcliente})
exten => _X.,n,GotoIf($["${idcliente}"=""]?colgar)
exten => _X.,n,Set(EXTEN=${numero})
exten => _X.,n,Goto(celular,${EXTEN},1)
exten => _X.,n(colgar),Playback(beep)
exten => _X.,n,Hangup()
exten => _X.,n(interno),Goto(users,${EXTEN},1)


[cedulacolp]
exten => _X.,1,Set(numero=${EXTEN})
exten => _X.,n,GotoIf($[${LEN(${numero})}<4]?interno)
exten => _X.,n,NoOp(El numero marcado es ${numero})
exten => _X.,n,Read(idcliente,cedula,10,,2,4)
exten => _X.,n,NoOp(el estado de la funcion read es: ${READSTATUS})
exten => _X.,n,NoOp(La cedula del cliente es ${idcliente})
exten => _X.,n,GotoIf($["${idcliente}"=""]?colgar)
exten => _X.,n,Set(EXTEN=${numero})
exten => _X.,n,Goto(celular,${EXTEN},1)
exten => _X.,n(colgar),Playback(beep)
exten => _X.,n,Hangup()
exten => _X.,n(interno),Goto(users,${EXTEN},1)

[users]
include => servicios
include => grabarmsg

;********  Llamadas  locales para que salgan linea SIP de Telmex *********
exten => _NXXXXXX,1,Answer()
exten => _NXXXXXX,n,NoOp(extension ${CALLERID(num)})
;exten => _NXXXXXX,n,GotoIf($["${DB(users/t${CALLERID(num)}/Record)}" = "1"]?Record:NoRecord)
exten => _NXXXXXX,n(Record),set(calltime=${STRFTIME(${EPOCH},,%C%y%m%d_%H%M%S)})
;exten => _NXXXXXX,n,MixMonitor(${DIRGRABACIONES}${CALLERID(num)}/saliente/${calltime}_${CALLERID(num)}_${EXTEN}.wav,b)
exten => _NXXXXXX,n,Set(filename=BED4_${idcliente}_${calltime}_${CALLERID(num)}_${EXTEN})
exten => _NXXXXXX,n,Set(CDR(userfield)=${idcliente})
exten => _NXXXXXX,n,NoOp(El nombre del archivo es ${filename})
exten => _NXXXXXX,n,MixMonitor(${DIRGRABACIONES}${CALLERID(num)}/saliente/${filename}.wav)
;exten => _NXXXXXX,n(NoRecord),NoOp(No se graba)
exten => _NXXXXXX,n,NoOp(El campo userfield es ${CDR(userfield)})
exten => _NXXXXXX,n,Dial(SIP/${EXTEN}@to_telmex,60,T)
exten => _NXXXXXX,n,NoOp(El campo userfield esta en: ${CDR(userfield)} y el unique id en: ${CDR(uniqueid)})
exten => _NXXXXXX,n,Hangup()

;*****************************************************************************************************************



exten => 200,1,VoicemailMain(200@default)
exten => 201,1,Macro(stduser,SIP/201,t201)
exten => 202,1,Macro(stduser,SIP/202,t202)
exten => 203,1,Macro(stduser,SIP/203,t203)
exten => 204,1,Macro(stduser,SIP/204,t204)
exten => 205,1,Macro(stduser,SIP/205,t205)
exten => 206,1,Macro(stduser,SIP/206,t206)
exten => 207,1,Macro(stduser,SIP/207,t207)
exten => 208,1,Macro(user,SIP/208,t208)
exten => 209,1,Macro(stduser,SIP/209,t209)
exten => 210,1,Macro(stduser,SIP/210,t210)
exten => 211,1,Macro(user,SIP/211,t211)
exten => 212,1,Macro(user,SIP/212,t212)
exten => 213,1,Macro(user,SIP/213,t213)
exten => 214,1,Macro(user,SIP/214,t214)
exten => 215,1,Macro(stduser,SIP/215,t215)
exten => 216,1,Macro(stduser,SIP/216,t216)
exten => 217,1,Macro(stduser,SIP/217,t217)
exten => 218,1,Macro(stduser,SIP/218,t218)
exten => 219,1,Macro(stduser,SIP/219,t219)
exten => 220,1,Macro(stduser,SIP/220,t220)
exten => 221,1,Macro(stduser,SIP/221,t221)
exten => 222,1,Macro(stduser,SIP/222,t222)
exten => 223,1,Macro(stduser,SIP/223,t223)
exten => 224,1,Macro(stduser,SIP/224,t224)
exten => 225,1,Macro(stduser,SIP/225,t225)
exten => 226,1,Macro(stduser,SIP/226,t226)
exten => 227,1,Macro(stduser,SIP/227,t227)
exten => 228,1,Macro(stduser,SIP/228,t228)
exten => 229,1,Macro(stduser,SIP/229,t229)
exten => 230,1,Macro(stduser,SIP/230,t230)
exten => 231,1,Macro(stduser,SIP/231,t231)
exten => 232,1,Macro(user,SIP/232,t232)
exten => 233,1,Macro(stduser,SIP/233,t233)
exten => 234,1,Macro(stduser,SIP/234,t234)
exten => 235,1,Macro(stduser,SIP/235,t235)
exten => 236,1,Macro(stduser,SIP/236,t236)
exten => 237,1,Macro(stduser,SIP/237,t237)
exten => 238,1,Macro(stduser,SIP/238,t238)
exten => 239,1,Macro(stduser,SIP/239,t239)
exten => 240,1,Macro(stduser,SIP/240,t240)
exten => 241,1,Macro(stduser,SIP/241,t241)
exten => 242,1,Macro(stduser,SIP/242,t242)
exten => 243,1,Macro(stduser,SIP/243,t243)
exten => 244,1,Macro(stduser,SIP/244,t244)
exten => 245,1,Macro(stduser,SIP/245,t245)
exten => 246,1,Macro(stduser,SIP/246,t246)
exten => 247,1,Macro(stduser,SIP/247,t247)
exten => 248,1,Macro(stduser,SIP/248,t248)
exten => 249,1,Macro(stduser,SIP/249,t249)
exten => 250,1,Macro(stduser,SIP/250,t250)
exten => 251,1,Macro(stduser,SIP/251,t251)
exten => 252,1,Macro(stduser,SIP/252,t252)
exten => 253,1,Macro(stduser,SIP/253,t253)
exten => 254,1,Macro(stduser,SIP/254,t254)
exten => 255,1,Macro(stduser,SIP/255,t255)
exten => 256,1,Macro(stduser,SIP/256,t256)
exten => 257,1,Macro(stduser,SIP/257,t257)
exten => 258,1,Macro(stduser,SIP/258,t258)
exten => 259,1,Macro(stduser,SIP/259,t259)
exten => 260,1,Macro(stduser,SIP/260,t260)
exten => 261,1,Macro(stduser,SIP/261,t261)
exten => 262,1,Macro(stduser,SIP/262,t262)
exten => 263,1,Macro(stduser,SIP/263,t263)
exten => 264,1,Macro(stduser,SIP/264,t264)
exten => 265,1,Macro(stduser,SIP/265,t265)
exten => 266,1,Macro(stduser,SIP/266,t266)
exten => 267,1,Macro(stduser,SIP/267,t267)
exten => 268,1,Macro(stduser,SIP/268,t268)
exten => 269,1,Macro(stduser,SIP/269,t269)
exten => 270,1,Macro(stduser,SIP/270,t270)
exten => 271,1,Macro(stduser,SIP/271,t271)
exten => 272,1,Macro(stduser,SIP/272,t272)
exten => 273,1,Macro(stduser,SIP/273,t273)
exten => 274,1,Macro(stduser,SIP/274,t274)
exten => 275,1,Macro(stduser,SIP/275,t275)
exten => 276,1,Macro(stduser,SIP/276,t276)
exten => 277,1,Macro(stduser,SIP/277,t277)
exten => 278,1,Macro(stduser,SIP/278,t278)
exten => 279,1,Macro(stduser,SIP/279,t279)
exten => 280,1,Macro(stduser,SIP/280,t280)

exten => 290,1,Macro(stduser,IAX2/290,t290)
exten => 291,1,Macro(user,IAX2/291,t291)
exten => 292,1,Macro(stduser,IAX2/292,t292)
exten => 293,1,Macro(stduser,IAX2/293,t293)
exten => 294,1,Macro(stduser,IAX2/294,t294)
exten => 295,1,Macro(stduser,IAX2/295,t295)
exten => 296,1,Macro(stduser,IAX2/296,t296)
exten => 297,1,Macro(stduser,IAX2/297,t297)
exten => 298,1,Macro(stduser,IAX2/298,t298)
exten => 299,1,Macro(stduser,IAX2/299,t299)


;*******************************************
;****  SERVICIOS

[servicios]
include => parkedcalls


;***********  PICKUP ***********
exten => 40,1,Answer()
exten => 40,n,PickupChan(SIP/201&SIP/202&SIP/203&SIP/204&SIP/205&SIP/206&SIP/207&SIP/208&SIP/209&SIP/210&SIP/211&SIP/212&SIP/213&SIP/214&SIP/215&SIP/216&SIP/217&SIP/218&SIP/219&SIP/220&SIP/221&SIP/222&SIP/223&SIP/224&SIP/225&SIP/226&SIP/227&SIP/228&SIP/229&SIP/230&SIP/231&SIP/247)
exten => 40,n,Hangup()

;***********  ACTIVAR GRABACION ***********
exten => 600,1,Answer()
exten => 600,n,Wait(0.5)
exten => 600,n,Set(DB(users/${USERID}/Record)=1)
exten => 600,n,Playback(to-record-call)
exten => 600,n,Playback(on)
exten => 600,n,Hangup()

;***********  DESACTIVAR GRABACION ***********
exten => 601,1,Answer()
exten => 601,n,Wait(0.5)
exten => 601,n,Set(DB(users/${USERID}/Record)=0)
exten => 601,n,Playback(to-record-call)
exten => 601,n,Playback(off-duty)
exten => 601,n,Hangup()

;***********  PROBAR EL IVR ********************
exten => 680,1,Goto(ivr,s,1)

;******  GRABAR MENSAJE DEL IVR *****************
exten => 681,1,Answer()
exten => 681,n,Authenticate(1301)
exten => 681,n,Wait(0.5)
exten => 681,n,Record(menu-ivr.gsm)
exten => 681,n,Wait(1)
exten => 681,n,Playback(menu-ivr)
exten => 681,n,Hangup()

;******  GRABAR MENSAJE SOLICITAR NUMERO DE CEDULA *****************
exten => 682,1,Answer()
exten => 682,n,Authenticate(1301)
exten => 682,n,Wait(0.5)
exten => 682,n,Record(cedula.gsm)
exten => 682,n,Wait(1)
exten => 682,n,Playback(cedula)
exten => 682,n,Hangup()

;******  GRABAR MENSAJE SOLICITAR NUMERO DE CEDULA CLIENTE*****************
exten => 683,1,Answer()
exten => 683,n,Authenticate(1301)
exten => 683,n,Wait(0.5)
exten => 683,n,Record(ivr-cedula.gsm)
exten => 683,n,Wait(1)
exten => 683,n,Playback(ivr-cedula)
exten => 683,n,Hangup()

;******  GRABAR MENSAJE CUANDO ESTAMOS OCUPADOS Y VA AL BUZON DE VOZ EXT 200*****
exten => 684,1,Answer()
exten => 684,n,Authenticate(1301)
exten => 684,n,Wait(0.5)
exten => 684,n,Record(ocupados.gsm)
exten => 684,n,Wait(1)
exten => 684,n,Playback(ocupados)
exten => 684,n,Hangup()

;******  CONSULTAR SALDO CELULAR LINEA 1 *****************
exten => 691,1,Answer()
exten => 691,n,Wait(0.5)
exten => 691,n,Dial(DAHDI/g2/*611,20)
exten => 691,n,Hangup()

;******  CONSULTAR SALDO CELULAR LINEA 2 *****************
exten => 692,1,Answer()
exten => 692,n,Wait(0.5)
exten => 692,n,Dial(DAHDI/g3/*611,20)
exten => 692,n,Hangup()

;******  CONSULTAR SALDO CELULAR LINEA 3 *****************
exten => 693,1,Answer()
exten => 693,n,Wait(0.5)
exten => 693,n,Dial(DAHDI/g4/*611,20)
exten => 693,n,Hangup()

;******  CONSULTAR VOICEMAIL *****************
;exten => 610,1,Answer()
;exten => 610,n,VoiceMailMain(@default)


;******   SALA DE CONFERENCIA  *****************
exten => 620,1,Meetme(Ejecutivos,dpM)



;******  TEST CONECTIVIDAD  *****************/
exten => 6000,1,Answer()
exten => 6000,n,Playback(tt-monkeys)
exten => 6000,n,Hangup()

exten => 6001,1,Wait(1)
exten => 6001,n,Record(30.gsm)
exten => 6001,n,Hangup()

;******************** FAX **********************
exten => 105,1,Answer()
exten => 105,n,Wait(3)
exten => 105,n,Dial(IAX2/300)


;****************  PRUEBA CHANSPY  **********************
exten => 630,1,Answer()
exten => 630,n,Wait(0.5)
exten => 630,n,Authenticate(4312)
exten => 630,n,Chanspy()
exten => 630,n,Hangup()

exten => 631,1,Answer()
exten => 631,n,Wait(0.5)
exten => 631,n,Authenticate(1301)
exten => 631,n,Chanspy()
exten => 631,n,Hangup()

exten => _8XXX,1,Answer()
exten => _8XXX,n,Wait(0.5)
exten => _8XXX,n,SET(CHANNEL(language)=es)
exten => _8XXX,n,Authenticate(4312)
exten => _8XXX,n,Chanspy(SIP/${EXTEN:1},q)
exten => _8XXX,n,Hangup()


;******  Seccion mensajes marcador automatico *******


[outboundmsg1]
;exten => s,1,Answer()
;exten => s,n,Wait(1)
;exten => s,n,Background(msg1)
;exten => s,n,Hangup()

exten => s,1,Set(BUZON=0)
exten => s,n,Answer()
exten => s,n,BackgroundDetect(5, 1000, 50)
exten => s,n,Noop(Detectado buzon de voz)
exten => s,n,Set(BUZON=1)
exten => s,n,BackgroundDetect(30, 1000, 50, 30050)
exten => s,n,Noop(Esperando mensaje del buzon)
exten => s,n,Hangup()
exten => talk,1,Background(msg1)
exten => talk,n,Hangup()


[outboundmsg2]
;exten => s,1,Answer()
;exten => s,n,Wait(1)
;exten => s,n,Background(msg2)
;exten => s,n,Hangup()

exten => s,1,Set(BUZON=0)
exten => s,n,Answer()
exten => s,n,BackgroundDetect(5, 1000, 50)
exten => s,n,Noop(Detectado buzon de voz)
exten => s,n,Set(BUZON=1)
exten => s,n,BackgroundDetect(30, 1000, 50, 30050)
exten => s,n,Noop(Esperando mensaje del buzon)
exten => s,n,Hangup()
exten => talk,1,Background(msg2)
exten => talk,n,Hangup()

[outboundmsg3]
;exten => s,1,Answer()
;exten => s,n,Wait(1)
;exten => s,n,Background(msg3)
;exten => s,n,Hangup()

exten => s,1,Set(BUZON=0)
exten => s,n,Answer()
exten => s,n,BackgroundDetect(5, 1000, 50)
exten => s,n,Noop(Detectado buzon de voz)
exten => s,n,Set(BUZON=1)
exten => s,n,BackgroundDetect(30, 1000, 50, 30050)
exten => s,n,Noop(Esperando mensaje del buzon)
exten => s,n,Hangup()
exten => talk,1,Background(msg3)
exten => talk,n,Hangup()

[outboundmsg4]
;exten => s,1,Answer()
;exten => s,n,Wait(1)
;exten => s,n,Background(msg4)
;exten => s,n,Hangup()

exten => s,1,Set(BUZON=0)
exten => s,n,Answer()
exten => s,n,BackgroundDetect(5, 1000, 50)
exten => s,n,Noop(Detectado buzon de voz)
exten => s,n,Set(BUZON=1)
exten => s,n,BackgroundDetect(30, 1000, 50, 30050)
exten => s,n,Noop(Esperando mensaje del buzon)
exten => s,n,Hangup()
exten => talk,1,Background(msg4)
exten => talk,n,Hangup()

[outboundmsg5]
;exten => s,1,Answer()
;exten => s,n,Wait(1)
;exten => s,n,Background(msg5)
;exten => s,n,Hangup()

exten => s,1,Set(BUZON=0)
exten => s,n,Answer()
exten => s,n,BackgroundDetect(5, 1000, 50)
exten => s,n,Noop(Detectado buzon de voz)
exten => s,n,Set(BUZON=1)
exten => s,n,BackgroundDetect(30, 1000, 50, 30050)
exten => s,n,Noop(Esperando mensaje del buzon)
exten => s,n,Hangup()
exten => talk,1,Background(msg5)
exten => talk,n,Hangup()

[outboundmsg6]
;exten => s,1,Answer()
;exten => s,n,Wait(1)
;exten => s,n,Background(msg6)
;exten => s,n,Hangup()

exten => s,1,Set(BUZON=0)
exten => s,n,Answer()
exten => s,n,BackgroundDetect(5, 1000, 50)
exten => s,n,Noop(Detectado buzon de voz)
exten => s,n,Set(BUZON=1)
exten => s,n,BackgroundDetect(30, 1000, 50, 30050)
exten => s,n,Noop(Esperando mensaje del buzon)
exten => s,n,Hangup()
exten => talk,1,Background(msg6)
exten => talk,n,Hangup()

[outboundmsg7]
;exten => s,1,Answer()
;exten => s,n,Wait(1)
;exten => s,n,Background(msg7)
;exten => s,n,Hangup()

exten => s,1,Set(BUZON=0)
exten => s,n,Answer()
exten => s,n,BackgroundDetect(5, 1000, 50)
exten => s,n,Noop(Detectado buzon de voz)
exten => s,n,Set(BUZON=1)
exten => s,n,BackgroundDetect(30, 1000, 50, 30050)
exten => s,n,Noop(Esperando mensaje del buzon)
exten => s,n,Hangup()
exten => talk,1,Background(msg7)
exten => talk,n,Hangup()

[outboundmsg8]
;exten => s,1,Answer()
;exten => s,n,Wait(1)
;exten => s,n,Background(msg8)
;exten => s,n,Hangup()

exten => s,1,Set(BUZON=0)
exten => s,n,Answer()
exten => s,n,BackgroundDetect(5, 1000, 50)
exten => s,n,Noop(Detectado buzon de voz)
exten => s,n,Set(BUZON=1)
exten => s,n,BackgroundDetect(30, 1000, 50, 30050)
exten => s,n,Noop(Esperando mensaje del buzon)
exten => s,n,Hangup()
exten => talk,1,Background(msg8)
exten => talk,n,Hangup()

;****************  GRABAR MENSAJES *****************
; Mensaje 1


[grabarmsg]
exten => 301,1,Wait(1)
exten => 301,n,Record(msg1.gsm)
exten => 301,n,Wait(2)
exten => 301,n,Playback(msg1)
exten => 301,n,Hangup()

exten => 401,1,Wait(1)
exten => 401,n,Playback(msg1)
exten => 401,n,Hangup()

; Mensaje 2

exten => 302,1,Wait(1)
exten => 302,n,Record(msg2.gsm)
exten => 302,n,Wait(2)
exten => 302,n,Playback(msg2)
exten => 302,n,Hangup()

exten => 402,1,Wait(1)
exten => 402,n,Playback(msg2)
exten => 402,n,Hangup()

; Mensaje 3

exten => 303,1,Wait(1)
exten => 303,n,Record(msg3.gsm)
exten => 303,n,Wait(2)
exten => 303,n,Playback(msg3)
exten => 303,n,Hangup()

exten => 403,1,Wait(1)
exten => 403,n,Playback(msg3)
exten => 403,n,Hangup()

; Mensaje 4

exten => 304,1,Wait(1)
exten => 304,n,Record(msg4.gsm)
exten => 304,n,Wait(2)
exten => 304,n,Playback(msg4)
exten => 304,n,Hangup()

exten => 404,1,Wait(1)
exten => 404,n,Playback(msg4)
exten => 404,n,Hangup()

; Mensaje 5

exten => 305,1,Wait(1)
exten => 305,n,Record(msg5.gsm)
exten => 305,n,Wait(2)
exten => 305,n,Playback(msg5)
exten => 305,n,Hangup()

exten => 405,1,Wait(1)
exten => 405,n,Playback(msg5)
exten => 405,n,Hangup()

; Mensaje 6

exten => 306,1,Wait(1)
exten => 306,n,Record(msg6.gsm)
exten => 306,n,Wait(2)
exten => 306,n,Playback(msg6)
exten => 306,n,Hangup()

exten => 406,1,Wait(1)
exten => 406,n,Playback(msg6)
exten => 406,n,Hangup()

; Mensaje 7

exten => 307,1,Wait(1)
exten => 307,n,Record(msg7.gsm)
exten => 307,n,Wait(2)
exten => 307,n,Playback(msg7)
exten => 307,n,Hangup()

exten => 407,1,Wait(1)
exten => 407,n,Playback(msg7)
exten => 407,n,Hangup()

; Mensaje 8

exten => 308,1,Wait(1)
exten => 308,n,Record(msg8.gsm)
exten => 308,n,Wait(2)
exten => 308,n,Playback(msg8)
exten => 308,n,Hangup()

exten => 408,1,Wait(1)

exten => 408,n,Playback(msg8)
exten => 408,n,Hangup()


[ivr]
exten => s,1,Answer()
exten => s,n,Wait(0.5u)
;exten => s,n, GotoIfTime(17:00-7:00,mon&fri,*,*?cerrado:menunormal)
;exten => s,n, GotoIfTime(14:55-7:00,sat&sun,*,*?cerrado)
;exten => s,n, GotoIfTime(
exten => s,n,Background(menu-ivr)
exten => s,n,WaitExten(5)

exten => _2XX,1,Goto(users,${EXTEN},1)

exten => 1,1,Set(cntloop=0)
exten => 1,n(loop1),Read(idcliente,ivr-cedula,11,,2,4)
exten => 1,n,Set(cntloop=$[${cntloop}+1])
exten => 1,n,GotoIf($["${cntloop}"="4"]?HANGUP)
exten => 1,n,GotoIf($["${idcliente}"=""]?loop1)
exten => 1,n,Set(__calleridtmp=${CALLERID(num)})
exten => 1,n,Set(CALLERID(num)=${CALLERID(num)}_${idcliente})
exten => 1,n,Set(calltime=${STRFTIME(${EPOCH},,%C%y%m%d_%H%M%S)})
exten => 1,n,Set(filename=BED4_${idcliente}_${calltime}_${CALLERID(num)})
exten => 1,n,Set(__CedulaCli=${idcliente})
exten => 1,n,NoOp(El nombre del archivo es ${filename})
;exten => 1,n,MixMonitor(${DIRGRABACIONES}209/entrante/${filename}.wav,b)
;exten => 1,n,MixMonitor(${DIRGRABACIONES}${ARG1:4)}/entrante/${filename}_${ARG1:4}.wav,b)
;exten => 1,n,NoOp(Grabando 209, llamado desde ${CALLERID(num)})
;exten => 1,n,Dial(SIP/209,70,Tt)
exten => 1,n,Queue(colpatria,t,,,120,,recordq)
exten => 1,n,NoOp(Valor del queuestatus = ${QUEUESTATUS})
exten => 1,n,GotoIf($["${QUEUESTATUS}" = "TIMEOUT"]?1000)
exten => 1,n,GotoIf($["${QUEUESTATUS}" = "JOINEMPTY"]?1000)
exten => 1,n,GotoIf($["${QUEUESTATUS}" = "JOINUNAVAIL"]?1000)
exten => 1,n,GotoIf($["${QUEUESTATUS}" = "FULL"]?1000)
;exten => 1,n,StopMixMonitor()
exten => 1,n,NoOp(${DIALSTATUS})
exten => 1,n,GotoIf($["${DIALSTATUS}" = "NOANSWER"]?UNAVAIL)
exten => 1,n,GotoIf($["${DIALSTATUS}" = "CHANUNAVAIL"]?UNAVAIL)
exten => 1,n,GotoIf($["${DIALSTATUS}" = "CONGESTION"]?UNAVAIL)
exten => 1,n,GotoIf($["${DIALSTATUS}" = "CANCEL"]?UNAVAIL)
exten => 1,n,GotoIf($["${DIALSTATUS}" = "BUSY"]?UNAVAIL)
exten => 1,n(HANGUP),Hangup()
exten => 1,n(UNAVAIL),NoOp(No contestaron la 209)
exten => 1,n,NoOp(Valor del queuestatus = ${QUEUESTATUS})
exten => 1,n,Hangup()
;exten => 1,1000,Goto(2,1)
exten => 1,1000,Answer()
exten => 1,n,Wait(0.5)
exten => 1,n,Playback(ocupados)
exten => 1,n,VoiceMail(200@default,b)
exten => 1,n,Hangup()



exten => 2,1,Set(cntloop=0)
exten => 2,n(loop1),Read(idcliente,ivr-cedula,11,,2,4)
exten => 2,n,Set(cntloop=$[${cntloop}+1])
exten => 2,n,GotoIf($["${cntloop}"="4"]?HANGUP)
exten => 2,n,GotoIf($["${idcliente}"=""]?loop1)
exten => 2,n,Set(__calleridtmp=${CALLERID(num)})
exten => 2,n,Set(CALLERID(num)=${CALLERID(num)}_${idcliente})
exten => 2,n(Record),set(calltime=${STRFTIME(${EPOCH},,%C%y%m%d_%H%M%S)})
exten => 2,n,Set(filename=BED4_${idcliente}_${calltime}_${CALLERID(num)})
exten => 2,n,Set(__CedulaCli=${idcliente})I
;exten => 2,n,MixMonitor(${DIRGRABACIONES}${CDR(dstchannel:4:3)}/entrante/${filename}.wav,b)
;exten => 2,n,Dial(IAX2/293&IAX2/294,40,Tt)
;exten => 2,n,NoOp(El nombre del archivo es ${filename})
;exten => 2,n,StopMixMonitor()
exten => 2,n,Queue(falabella,t,,,40,,recordq)
exten => 2,n,GotoIf($["${QUEUESTATUS}" = "TIMEOUT"]?1000)
exten => 2,n,GotoIf($["${QUEUESTATUS}" = "JOINEMPTY"]?1000)
exten => 2,n,GotoIf($["${QUEUESTATUS}" = "JOINUNAVAIL"]?1000)
exten => 2,n,GotoIf($["${QUEUESTATUS}" = "FULL"]?1000)
exten => 2,n,NoOp(Normal Queue exit)
exten => 2,n,Hangup()
;exten => 2,1000,Goto(4,1)
;exten => 2,1000,Dial(IAX2/293&IAX2/294,20,t)
exten => 2,n,NoOp(${DIALSTATUS})
exten => 2,n,GotoIf($["${DIALSTATUS}" = "NOANSWER"]?UNAVAIL)
exten => 2,n,GotoIf($["${DIALSTATUS}" = "CHANUNAVAIL"]?UNAVAIL)
exten => 2,n,GotoIf($["${DIALSTATUS}" = "CONGESTION"]?UNAVAIL)
exten => 2,n,GotoIf($["${DIALSTATUS}" = "CANCEL"]?HANGUP)
exten => 2,n,GotoIf($["${DIALSTATUS}" = "BUSY"]?UNAVAIL)
exten => 2,n,Hangup()
exten => 2,n(UNAVAIL),Answer()
exten => 2,n,Wait(0.5)
exten => 2,n,Playback(ocupados)
exten => 2,n,VoiceMail(200@default,b)
exten => 2,n,Hangup()
exten => 2,n(BUSY),Answer()
exten => 2,n,Wait(0.5)
exten => 2,n,Playback(ocupados)
exten => 2,n,VoiceMail(200@default,b)
exten => 2,n(HANGUP),Hangup()

exten => 3,1,Queue(otrocliente,t,,,,,recordq)
exten => 3,n,GotoIf($["${QUEUESTATUS}" = "JOINEMPTY"]?1000)
exten => 3,n,GotoIf($["${QUEUESTATUS}" = "JOINUNAVAIL"]?1000)
exten => 3,n,GotoIf($["${QUEUESTATUS}" = "FULL"]?1000)
exten => 3,n,NoOp(Normal Queue exit)
exten => 3,n,Hangup()
;exten => 3,1000,VoiceMail(232@default,u)
exten => 3,1000,Dial(SIP/209,20,t)
exten => 3,n,NoOp(${DIALSTATUS})
exten => 3,n,GotoIf($["${DIALSTATUS}" = "NOANSWER"]?UNAVAIL)
exten => 3,n,GotoIf($["${DIALSTATUS}" = "CHANUNAVAIL"]?UNAVAIL)
exten => 3,n,GotoIf($["${DIALSTATUS}" = "CONGESTION"]?UNAVAIL)
exten => 3,n,GotoIf($["${DIALSTATUS}" = "CANCEL"]?HANGUP)
exten => 3,n,GotoIf($["${DIALSTATUS}" = "BUSY"]?UNAVAIL)
exten => 3,n,Hangup()
exten => 3,n(UNAVAIL),Answer()
exten => 3,n,Wait(0.5)
exten => 3,n,Playback(ocupados)
exten => 3,n,VoiceMail(200@default,b)
exten => 3,n,Hangup()
exten => 3,n(BUSY),Answer()
exten => 3,n,Wait(0.5)
exten => 3,n,Playback(ocupados)
exten => 3,n,VoiceMail(200@default,b)
exten => 3,n(HANGUP),Hangup()

exten => 4,1,Queue(externos,t,,,,,recordq)
exten => 4,n,GotoIf($["${QUEUESTATUS}" = "JOINEMPTY"]?1000)
exten => 4,n,GotoIf($["${QUEUESTATUS}" = "JOINUNAVAIL"]?1000)
exten => 4,n,GotoIf($["${QUEUESTATUS}" = "FULL"]?1000)
exten => 4,n,NoOp(Normal Queue exit)
exten => 4,n,Hangup()
;exten => 4,1000,Goto(1,1)
exten => 4,1000,Dial(SIP/209,20,t)
exten => 4,n,NoOp(${DIALSTATUS})
exten => 4,n,GotoIf($["${DIALSTATUS}" = "NOANSWER"]?UNAVAIL)
exten => 4,n,GotoIf($["${DIALSTATUS}" = "CHANUNAVAIL"]?UNAVAIL)
exten => 4,n,GotoIf($["${DIALSTATUS}" = "CONGESTION"]?UNAVAIL)
exten => 4,n,GotoIf($["${DIALSTATUS}" = "CANCEL"]?HANGUP)
exten => 4,n,GotoIf($["${DIALSTATUS}" = "BUSY"]?UNAVAIL)
exten => 4,n,Hangup()
exten => 4,n(UNAVAIL),Answer()
exten => 4,n,Wait(0.5)
exten => 4,n,Playback(ocupados)
exten => 4,n,VoiceMail(200@default,b)
exten => 4,n,Hangup()
exten => 4,n(BUSY),Answer()
exten => 4,n,Wait(0.5)
exten => 4,n,Playback(ocupados)
exten => 4,n,VoiceMail(200@default,b)
exten => 4,n(HANGUP),Hangup()

exten => 5,1,Queue(admon,t,,,,,recordq)
exten => 5,n,GotoIf($["${QUEUESTATUS}" = "JOINEMPTY"]?1000)
exten => 5,n,GotoIf($["${QUEUESTATUS}" = "JOINUNAVAIL"]?1000)
exten => 5,n,GotoIf($["${QUEUESTATUS}" = "FULL"]?1000)
exten => 5,n,NoOp(Normal Queue exit)
exten => 5,n,Hangup()
;exten => 5,1000,Goto(1,1)
exten => 5,1000,Dial(SIP/209,20,t)
exten => 5,n,NoOp(${DIALSTATUS})
exten => 5,n,GotoIf($["${DIALSTATUS}" = "NOANSWER"]?UNAVAIL)
exten => 5,n,GotoIf($["${DIALSTATUS}" = "CHANUNAVAIL"]?UNAVAIL)
exten => 5,n,GotoIf($["${DIALSTATUS}" = "CONGESTION"]?UNAVAIL)
exten => 5,n,GotoIf($["${DIALSTATUS}" = "CANCEL"]?HANGUP)
exten => 5,n,GotoIf($["${DIALSTATUS}" = "BUSY"]?UNAVAIL)
exten => 5,n,Hangup()
exten => 5,n(UNAVAIL),Answer()
exten => 5,n,Wait(0.5)
exten => 5,n,Playback(ocupados)
exten => 5,n,VoiceMail(200@default,b)
exten => 5,n,Hangup()
exten => 5,n(BUSY),Answer()
exten => 5,n,Wait(0.5)
exten => 5,n,Playback(ocupados)
exten => 5,n,VoiceMail(200@default,b)
exten => 5,n(HANGUP),Hangup()

;exten => 5,1,Queue(direct,t,,,,,recordq)
;exten => 5,n,GotoIf($["${QUEUESTATUS}" = "JOINEMPTY"]?1000)
;exten => 5,n,GotoIf($["${QUEUESTATUS}" = "JOINUNAVAIL"]?1000)
;exten => 5,n,GotoIf($["${QUEUESTATUS}" = "FULL"]?1000)
;exten => 5,n,NoOp(Normal Queue exit)
;exten => 5,n,Hangup()
;exten => 5,1000,Goto(1,1)

exten => 8,1,Goto(servicios,631,1)

exten => 0,1,Goto(users,214,1)
exten => *,1,Goto(s,1)
;exten => t,1,Playback(goodbye)
exten => t,1,Goto(1,1)
;exten => t,n,Hangup()
exten => i,1,Playback(pbx-invalid)
exten => i,n,Goto(s,1)

;********************************************
;****  MACROS

[macro-user]

exten => s,1,NoOp(Callerid ${CALLERID(num)})
exten => s,n,NoOp(Extension ${ARG1:4})
;exten => s,n,GotoIf($["${DB(users/${ARG2}/Record)}" = "1"]?Record:NoRecord)
exten => s,n(Record),set(calltime=${STRFTIME(${EPOCH},,%C%y%m%d_%H%M%S)})
exten => s,n,Set(filename=BED4_${idcliente}_${calltime}_${CALLERID(num)}_${ARG1:4})
exten => s,n,Set(CDR(userfield)=${idcliente})
exten => s,n,NoOp(El nombre del archivo es ${filename})
exten => s,n,MixMonitor(${DIRGRABACIONES}${ARG1:4}/entrante/${filename}.wav,b)
;exten => s,n,Set(CALLERID(num)=${CALLERID(num)}-${idcliente})
exten => s,n,NoOp(Grabando ${ARG1:4}, llamado desde ${CALLERID(num)})
exten => s,n,Goto(Marcar)
exten => s,n(NoRecord),NoOp(No se graba)
exten => s,n(Marcar),Set(__DYNAMIC_FEATURES=testfeature#obtener_cc)
exten => s,n,Dial(${ARG1},20,Tt)
exten => s,n,StopMixMonitor()
exten => s,n,NoOp(${DIALSTATUS})
exten => s,n,GotoIf($["${DIALSTATUS}" = "NOANSWER"]?UNAVAIL)
exten => s,n,GotoIf($["${DIALSTATUS}" = "CHANUNAVAIL"]?UNAVAIL)
exten => s,n,GotoIf($["${DIALSTATUS}" = "CONGESTION"]?UNAVAIL)
exten => s,n,GotoIf($["${DIALSTATUS}" = "CANCEL"]?HANGUP)
exten => s,n,GotoIf($["${DIALSTATUS}" = "BUSY"]?BUSY)
exten => s,n,Goto(CONGEST)
exten => s,n(UNAVAIL),Answer()
exten => s,n,Wait(0.5)
exten => s,n,VoiceMail(${MACRO_EXTEN}@default,u)
exten => s,n,Hangup()
exten => s,n(BUSY),Answer()
exten => s,n,Wait(0.5)
exten => s,n,VoiceMail(${MACRO_EXTEN}@default,b)
exten => s,n,Hangup()
exten => s,n(CONGEST),Answer()
exten => s,n,Wait(0.5)
exten => s,n,Congestion()
exten => s,n(HANGUP),Hangup()


[macro-stduser]

exten => s,1,NoOp(Callerid ${CALLERID(num)})
exten => s,n,NoOp(Extension ${ARG1:4})
;exten => s,n,GotoIf($["${DB(users/${ARG2}/Record)}" = "1"]?Record:NoRecorD)
exten => s,n(Record),set(calltime=${STRFTIME(${EPOCH},,%C%y%m%d_%H%M%S)})
exten => s,n,Set(filename=BED4_${idcliente}_${calltime}_${CALLERID(num)}})
exten => s,n,Set(CDR(userfield)=${idcliente})
exten => s,n,NoOp(El nombre del archivo es ${filename})
exten => s,n,MixMonitor(${DIRGRABACIONES}${ARG1:4}/entrante/${filename}.wav,b)
;exten => s,n,MixMonitor(${DIRGRABACIONES}${ARG1:4)}/entrante/${calltime}_${ARG1:4}_${CALLERID(num)}.wav,b)
exten => s,n,NoOp(Grabando ${ARG1:4}, llamado desde ${CALLERID(num)})
exten => s,n,Goto(Marcar)
exten => s,n(NoRecord),NoOp(No se graba)
exten => s,n(Marcar),Dial(${ARG1},20,Tt)
exten => s,n,StopMixMonitor()
exten => s,n,NoOp(${DIALSTATUS})
exten => s,n,GotoIf($["${DIALSTATUS}" = "NOANSWER"]?UNAVAIL)
exten => s,n,GotoIf($["${DIALSTATUS}" = "CHANUNAVAIL"]?UNAVAIL)
exten => s,n,GotoIf($["${DIALSTATUS}" = "CONGESTION"]?UNAVAIL)
exten => s,n,GotoIf($["${DIALSTATUS}" = "CANCEL"]?HANGUP)
exten => s,n,GotoIf($["${DIALSTATUS}" = "BUSY"]?UNAVAIL)
exten => s,n,Goto(CONGEST)
exten => s,n(UNAVAIL),Answer()
exten => s,n,Wait(0.5)
exten => s,n,Goto(ivr,1,perdidas)
exten => s,n(BUSY),Answer()
exten => s,n,Wait(0.5)
exten => s,n,VoiceMail(${MACRO_EXTEN}@default,b)
exten => s,n,Hangup()
exten => s,n(CONGEST),Answer()
exten => s,n,Wait(0.5)
exten => s,n,Congestion()
exten => s,n(HANGUP),Hangup()

[macro-agentes]
exten => s,1,NoOp(Agente llamando a ${MACRO_EXTEN} en ${ARG1})
exten => s,n,Dial(${ARG1},20,Tt)
exten => s,n,MixMonitor(~/test_record.wav)
exten => s,n,Hangup()

[macro-recordq]
exten => s,1,NoOp(CANAL ${CHANNEL:4:3} )
exten => s,n,NoOp(Numero ${calleridtmp})
exten => s,n,NoOP(Cedula ${CedulaCli} )
exten => s,n,NoOP(Gestor ${CALLERID(name)} )
exten => s,n,Set(Extension=${CHANNEL:4:3})
exten => s,n(Record),Set(calltime=${STRFTIME(${EPOCH},,%C%y%m%d_%H%M%S)})
exten => s,n,Set(filename=BED4_${CedulaCli}_${calltime}_${calleridtmp}_${Extension})
exten => s,n,Set(CDR(userfield)=${idcliente})
exten => s,n,NoOp(El nombre del archivo es ${filename})
exten => s,n,MixMonitor(${DIRGRABACIONES}${Extension}/entrante/${filename}.wav,b)
;exten => s,n,MixMonitor(${DIRGRABACIONES}${CDR(dstchannel):4:3}/entranteI/${calltime}_${CDR(dstchannel):4:3}_${CALLERID(num)}.wav,b)
;exten => s,n,Set(CALLERID(num)=${CALLERID(num)}-${idcliente})
;exten => s,n,NoOp(Grabando ${ARG1:4}, llamado desde ${CALLERID(num)})
;exten => s,n(NoRecord),NoOp(No se graba)
[default]
exten => s,1,Hangup()

[macro-stdexten]
exten = s,1,Set(__DYNAMIC_FEATURES=${FEATURES})
exten = s,2,GotoIf($["${FOLLOWME_${ARG1}}" = "1"]?5:3)
exten = s,3,Dial(${ARG2},${RINGTIME},${DIALOPTIONS})
exten = s,4,Goto(s-${DIALSTATUS},1)
exten = s,5,Macro(stdexten-followme,${ARG1},${ARG2})
exten = s-NOANSWER,1,Voicemail{ARG1},u)
exten = s-NOANSWER,2,Goto(default,s,1)
exten = s-BUSY,1,Voicemail(${ARG1},b)
exten = s-BUSY,2,Goto(default,s,1)
exten = _s-.,1,Goto(s-NOANSWER,1)
exten = a,1,VoicemailMain(${ARG1})
[macro-stdexten-followme]
exten = s,1,Answer
exten = s,2,Dial(${ARG2},${RINGTIME},${DIALOPTIONS})
exten = s,3,Set(__FMCIDNUM=${CALLERID(num)})
exten = s,4,Set(__FMCIDNAME=${CALLERID(name)})
exten = s,5,Followme(${ARG1},${FOLLOWMEOPTIONS})
exten = s,6,Voicemail(${ARG1},u)
exten = s-NOANSWER,1,Voicemail(${ARG1},u)
exten = s-BUSY,1,Voicemail(${ARG1},b)
exten = s-BUSY,2,Goto(default,s,1)
exten = _s-.,1,Goto(s-NOANSWER,1)
exten = a,1,VoicemailMain(${ARG1})
[macro-pagingintercom]
exten = s,1,SIPAddHeader(Alert-Info: ${PAGING_HEADER})
exten = s,2,Page(${ARG1},${ARG2})
exten = s,3,Hangup
[conferences]
[ringgroups]
[queues]
[voicemenus]
[voicemailgroups]
[directory]
[page_an_extension]
[pagegroups]
[asterisk_guitools]
exten = executecommand,1,System(${command})
exten = executecommand,n,Hangup()
exten = record_vmenu,1,Answer
exten = record_vmenu,n,Playback(vm-intro)
exten = record_vmenu,n,Record(${var1})
exten = record_vmenu,n,Playback(vm-saved)
exten = record_vmenu,n,Playback(vm-goodbye)
exten = record_vmenu,n,Hangup
exten = play_file,1,Answer
exten = play_file,n,Playback(${var1})
exten = play_file,n,Hangup
[macro-trunkdial-failover-0.3]
exten = s,1,GotoIf($[${LEN(${FMCIDNUM})} > 6]?1-fmsetcid,1)
exten = s,2,GotoIf($[${LEN(${GLOBAL_OUTBOUNDCIDNAME})} > 1]?1-setgbobname,1)
exten = s,3,Set(CALLERID(num)=${IF($[${LEN(${CID_${CALLERID(num)}})} > 2]?${CID_${CALLERID(num)}}:)})
exten = s,n,GotoIf($[${LEN(${CALLERID(num)})} > 6]?1-dial,1)
exten = s,n,Set(CALLERID(all)=${IF($[${LEN(${CID_${ARG3}})} > 6]?${CID_${ARG3}}:${GLOBAL_OUTBOUNDCID})})
exten = s,n,Goto(1-dial,1)
exten = 1-setgbobname,1,Set(CALLERID(name)=${GLOBAL_OUTBOUNDCIDNAME})
exten = 1-setgbobname,n,Goto(s,3)
exten = 1-fmsetcid,1,Set(CALLERID(num)=${FMCIDNUM})
exten = 1-fmsetcid,n,Set(CALLERID(name)=${FMCIDNAME})
exten = 1-fmsetcid,n,Goto(1-dial,1)
exten = 1-dial,1,Dial(${ARG1})
exten = 1-dial,n,Gotoif(${LEN(${ARG2})} > 0 ?1-${DIALSTATUS},1:1-out,1)
exten = 1-CHANUNAVAIL,1,Dial(${ARG2})
exten = 1-CHANUNAVAIL,n,Hangup()
exten = 1-CONGESTION,1,Dial(${ARG2})
exten = 1-CONGESTION,n,Hangup()
exten = 1-out,1,Hangup()
